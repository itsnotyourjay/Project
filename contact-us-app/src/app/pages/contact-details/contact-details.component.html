<div class="container mt-4">
  <!-- Header with title and buttons -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <button class="btn btn-outline-secondary me-2" (click)="onBack()">
        <i class="bi bi-arrow-left"></i> Back to List
      </button>
      <h2 class="d-inline-block mb-0">Contact Details</h2>
    </div>
    <button class="btn btn-outline-secondary" (click)="onLogout()">
      Logout
    </button>
  </div>

  <!-- Loading state -->
  <div *ngIf="loading && !error" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading contact details...</p>
  </div>

  <!-- Error state -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    {{ error }}
    <button class="btn btn-sm btn-outline-danger ms-3" (click)="loadContact()">
      Retry
    </button>
  </div>

  <!-- Success message -->
  <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="bi bi-check-circle-fill me-2"></i>{{ successMessage }}
    <button type="button" class="btn-close" (click)="successMessage = null"></button>
  </div>

  <!-- Contact Details Form -->
  <div *ngIf="!loading || error" class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        <i class="bi bi-person-circle me-2"></i>
        {{ isEditing ? 'Edit Contact' : 'Contact Information' }}
      </h5>
      <div>
        <button 
          *ngIf="!isEditing" 
          class="btn btn-sm btn-primary me-2" 
          (click)="toggleEdit()">
          <i class="bi bi-pencil"></i> Edit
        </button>
        <button 
          *ngIf="isEditing" 
          class="btn btn-sm btn-secondary me-2" 
          (click)="toggleEdit()">
          <i class="bi bi-x-circle"></i> Cancel
        </button>
        <button 
          *ngIf="!isEditing" 
          class="btn btn-sm btn-danger" 
          (click)="onDelete()">
          <i class="bi bi-trash"></i> Delete
        </button>
      </div>
    </div>
    
    <div class="card-body">
      <form [formGroup]="contactForm" (ngSubmit)="onUpdate()">
        <!-- Name Field -->
        <div class="mb-3">
          <label for="name" class="form-label">
            <i class="bi bi-person me-1"></i>Name
          </label>
          <input 
            type="text" 
            class="form-control" 
            [class.is-invalid]="isFieldInvalid('name')"
            id="name" 
            formControlName="name"
            placeholder="Enter name">
          <div class="invalid-feedback" *ngIf="isFieldInvalid('name')">
            <span *ngIf="contactForm.get('name')?.errors?.['required']">Name is required</span>
            <span *ngIf="contactForm.get('name')?.errors?.['minlength']">Name must be at least 2 characters</span>
          </div>
        </div>

        <!-- Email Field -->
        <div class="mb-3">
          <label for="email" class="form-label">
            <i class="bi bi-envelope me-1"></i>Email
          </label>
          <input 
            type="email" 
            class="form-control" 
            [class.is-invalid]="isFieldInvalid('email')"
            id="email" 
            formControlName="email"
            placeholder="Enter email">
          <div class="invalid-feedback" *ngIf="isFieldInvalid('email')">
            <span *ngIf="contactForm.get('email')?.errors?.['required']">Email is required</span>
            <span *ngIf="contactForm.get('email')?.errors?.['email']">Please enter a valid email</span>
          </div>
        </div>

        <!-- Message Field -->
        <div class="mb-3">
          <label for="msg" class="form-label">
            <i class="bi bi-chat-left-text me-1"></i>Message
          </label>
          <textarea 
            class="form-control" 
            [class.is-invalid]="isFieldInvalid('msg')"
            id="msg" 
            formControlName="msg"
            rows="5"
            placeholder="Enter message"></textarea>
          <div class="invalid-feedback" *ngIf="isFieldInvalid('msg')">
            <span *ngIf="contactForm.get('msg')?.errors?.['required']">Message is required</span>
          </div>
        </div>

        <!-- Submit Button (only visible in edit mode) -->
        <div *ngIf="isEditing" class="d-grid gap-2">
          <button 
            type="submit" 
            class="btn btn-success"
            [disabled]="contactForm.invalid || loading">
            <i class="bi bi-check-circle me-2"></i>
            {{ loading ? 'Saving...' : 'Save Changes' }}
          </button>
        </div>
      </form>
    </div>

    <div class="card-footer text-muted">
      <small>
        <i class="bi bi-info-circle me-1"></i>
        Contact ID: #{{ contactId }}
      </small>
    </div>
  </div>
</div>
